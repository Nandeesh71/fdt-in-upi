{"ast":null,"code":"import _objectSpread from\"C:/Users/jerol/OneDrive/Desktop/FDT_HOST/fdt-in-upi/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";/**\r\n * WebAuthn Biometric Authentication Utilities\r\n * Handles WebAuthn operations with production-grade error handling\r\n */const BASE_URL=process.env.REACT_APP_API_URL||'http://localhost:8001';/**\r\n * Base64URL encode\r\n */function base64urlEncode(buffer){if(typeof buffer==='string'){buffer=new TextEncoder().encode(buffer);}return btoa(String.fromCharCode(...new Uint8Array(buffer))).replace(/\\+/g,'-').replace(/\\//g,'_').replace(/=/g,'');}/**\r\n * Base64URL decode\r\n */function base64urlDecode(str){let padded=str;const padLength=(4-padded.length%4)%4;padded+='='.repeat(padLength);const decoded=atob(padded.replace(/-/g,'+').replace(/_/g,'/'));const bytes=new Uint8Array(decoded.length);for(let i=0;i<decoded.length;i++){bytes[i]=decoded.charCodeAt(i);}return bytes.buffer;}/**\r\n * Check if platform authenticator is available\r\n */async function isPlatformAuthenticatorAvailable(){if(typeof window==='undefined'||!window.PublicKeyCredential){console.warn('WebAuthn not supported in this browser');return false;}try{// eslint-disable-next-line no-undef\nreturn await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();}catch(error){console.error('Error checking platform authenticator:',error);return false;}}/**\r\n * Get biometric registration options from server\r\n */async function getRegistrationOptions(){let deviceName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;try{const token=localStorage.getItem('fdt_token');if(!token){throw new Error('No authentication token. Please log in first.');}const response=await fetch(\"\".concat(BASE_URL,\"/api/biometric/register/options\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({device_name:deviceName||'Registered Device'})});if(!response.ok){const error=await response.json();throw new Error(error.detail||'Failed to get registration options');}const data=await response.json();if(data.status!=='success'){throw new Error('Server returned error status');}return data.options;}catch(error){console.error('Error getting registration options:',error);throw error;}}/**\r\n * Register biometric credential\r\n */async function registerBiometricCredential(){let deviceName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;try{// Check if biometric is available\nconst available=await isPlatformAuthenticatorAvailable();if(!available){throw new Error('Biometric authentication not available on this device');}// Get challenge from server\nconst options=await getRegistrationOptions(deviceName);// Convert challenge to buffer\nconst optionsWithBuffers=_objectSpread(_objectSpread({},options),{},{challenge:new Uint8Array(base64urlDecode(options.challenge)),user:_objectSpread(_objectSpread({},options.user),{},{id:new Uint8Array(base64urlDecode(options.user.id))})});// Create credential\nconst credential=await navigator.credentials.create({publicKey:optionsWithBuffers});if(!credential){throw new Error('User cancelled registration or credential creation failed');}// Send verification to server\nconst response=await fetch(\"\".concat(BASE_URL,\"/api/biometric/register/verify\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(localStorage.getItem('fdt_token'))},body:JSON.stringify({credential_id:base64urlEncode(credential.id),attestation_object:base64urlEncode(credential.response.attestationObject),client_data_json:base64urlEncode(credential.response.clientDataJSON),device_name:deviceName||'Registered Device'})});if(!response.ok){const error=await response.json();throw new Error(error.detail||'Registration verification failed');}const data=await response.json();console.log('✅ Biometric registration successful');return data;}catch(error){console.error('Biometric registration error:',error);throw error;}}/**\r\n * Get biometric login options\r\n */async function getLoginOptions(){try{const response=await fetch(\"\".concat(BASE_URL,\"/api/biometric/login/options\"),{method:'POST',headers:{'Content-Type':'application/json'}});if(!response.ok){const error=await response.json();throw new Error(error.detail||'Failed to get login options');}const data=await response.json();return data.options;}catch(error){console.error('Error getting login options:',error);throw error;}}/**\r\n * Authenticate with biometric\r\n */async function authenticateWithBiometric(){try{// Check platform authenticator availability\nconst available=await isPlatformAuthenticatorAvailable();if(!available){throw new Error('Biometric authentication not available');}// Get challenge\nconst options=await getLoginOptions();// Convert challenge to buffer\nconst optionsWithBuffers=_objectSpread(_objectSpread({},options),{},{challenge:new Uint8Array(base64urlDecode(options.challenge))});// Get credential\nconst credential=await navigator.credentials.get({publicKey:optionsWithBuffers});if(!credential){throw new Error('User cancelled authentication or credential not found');}// Send verification to server\nconst response=await fetch(\"\".concat(BASE_URL,\"/api/biometric/login/verify\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({credential_id:base64urlEncode(credential.id),authenticator_data:base64urlEncode(credential.response.authenticatorData),client_data_json:base64urlEncode(credential.response.clientDataJSON),signature:base64urlEncode(credential.response.signature)})});if(!response.ok){const error=await response.json();throw new Error(error.detail||'Authentication failed');}const data=await response.json();console.log('✅ Biometric login successful');// Store token and user data\nlocalStorage.setItem('fdt_token',data.token);localStorage.setItem('fdt_user',JSON.stringify(data.user));return data;}catch(error){console.error('Biometric authentication error:',error);throw error;}}/**\r\n * Get biometric status\r\n */async function getBiometricStatus(){try{const token=localStorage.getItem('fdt_token');if(!token){throw new Error('Not authenticated');}const response=await fetch(\"\".concat(BASE_URL,\"/api/biometric/status\"),{method:'GET',headers:{'Authorization':\"Bearer \".concat(token)}});if(!response.ok){const error=await response.json();throw new Error(error.detail||'Failed to get status');}return await response.json();}catch(error){console.error('Error getting biometric status:',error);throw error;}}/**\r\n * Disable biometric\r\n */async function disableBiometric(){let credentialId=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;try{const token=localStorage.getItem('fdt_token');if(!token){throw new Error('Not authenticated');}const response=await fetch(\"\".concat(BASE_URL,\"/api/biometric/disable\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({credential_id:credentialId})});if(!response.ok){const error=await response.json();throw new Error(error.detail||'Failed to disable biometric');}return await response.json();}catch(error){console.error('Error disabling biometric:',error);throw error;}}/**\r\n * Verify biometric for transaction\r\n */async function verifyBiometricForTransaction(txId,credentialId){try{const token=localStorage.getItem('fdt_token');if(!token){throw new Error('Not authenticated');}// Get challenge from server\nconst challengeResponse=await fetch(\"\".concat(BASE_URL,\"/api/biometric/transaction/challenge\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({tx_id:txId})});if(!challengeResponse.ok){throw new Error('Failed to get transaction challenge');}const challengeData=await challengeResponse.json();const options=challengeData.options;// Convert challenge to buffer\nconst optionsWithBuffers=_objectSpread(_objectSpread({},options),{},{challenge:new Uint8Array(base64urlDecode(options.challenge))});// Get assertion\nconst credential=await navigator.credentials.get({publicKey:optionsWithBuffers});if(!credential){throw new Error('User cancelled biometric verification');}// Verify with server\nconst verifyResponse=await fetch(\"\".concat(BASE_URL,\"/api/biometric/transaction/verify\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({tx_id:txId,credential_id:credentialId,authenticator_data:base64urlEncode(credential.response.authenticatorData),client_data_json:base64urlEncode(credential.response.clientDataJSON),signature:base64urlEncode(credential.response.signature)})});if(!verifyResponse.ok){const error=await verifyResponse.json();throw new Error(error.detail||'Transaction verification failed');}return await verifyResponse.json();}catch(error){console.error('Transaction verification error:',error);throw error;}}export{isPlatformAuthenticatorAvailable,registerBiometricCredential,authenticateWithBiometric,getBiometricStatus,disableBiometric,verifyBiometricForTransaction,base64urlEncode,base64urlDecode};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}