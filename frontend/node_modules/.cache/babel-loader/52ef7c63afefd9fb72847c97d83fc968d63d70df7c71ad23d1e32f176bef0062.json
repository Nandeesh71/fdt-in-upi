{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{QRCodeSVG}from'qrcode.react';import{isPlatformAuthenticatorAvailable,getRegisteredCredentials,revokeCredential}from'../utils/webauthn';import{getAuthToken,setStoredUser}from'../api';import{formatUPIId}from'../utils/helpers';import BiometricSetup from'./BiometricSetup';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProfileScreen=_ref=>{var _user$name,_user$name$charAt;let{user}=_ref;const navigate=useNavigate();const[isEditing,setIsEditing]=useState(false);const[name,setName]=useState((user===null||user===void 0?void 0:user.name)||'');const[saving,setSaving]=useState(false);const[error,setError]=useState(null);const[success,setSuccess]=useState(null);// Biometric states\nconst[biometricSupported,setBiometricSupported]=useState(false);const[biometricCredentials,setBiometricCredentials]=useState([]);const[loadingBiometric,setLoadingBiometric]=useState(true);const[showBiometricSetup,setShowBiometricSetup]=useState(false);// Generate UPI ID from phone - use same formatting as Dashboard\nconst upiId=user!==null&&user!==void 0&&user.phone?formatUPIId(user.phone):'user@upi';useEffect(()=>{checkBiometricSupport();loadBiometricCredentials();},[]);const checkBiometricSupport=async()=>{const available=await isPlatformAuthenticatorAvailable();setBiometricSupported(available);};const loadBiometricCredentials=async()=>{try{setLoadingBiometric(true);const creds=await getRegisteredCredentials();setBiometricCredentials(creds||[]);}catch(err){console.error('Error loading biometric credentials:',err);}finally{setLoadingBiometric(false);}};const handleSaveName=async()=>{if(!name.trim()){setError('Name cannot be empty');return;}setSaving(true);setError(null);setSuccess(null);try{const response=await fetch(\"\".concat(process.env.REACT_APP_USER_BACKEND_URL||'http://localhost:8001',\"/api/user/profile\"),{method:'PUT',headers:{'Authorization':\"Bearer \".concat(getAuthToken()),'Content-Type':'application/json'},body:JSON.stringify({name})});if(!response.ok){throw new Error('Failed to update profile');}await response.json();// Update localStorage (for persistence across sessions)\nconst userData=JSON.parse(localStorage.getItem('fdt_user')||'{}');userData.name=name;setStoredUser(userData);setSuccess('Profile updated successfully!');setIsEditing(false);setTimeout(()=>setSuccess(null),3000);}catch(err){console.error('Error updating profile:',err);setError('Failed to update profile. Please try again.');}finally{setSaving(false);}};const handleRemoveBiometric=async(credentialId,deviceName)=>{if(!window.confirm(\"Remove \\\"\".concat(deviceName,\"\\\" from your account?\"))){return;}try{await revokeCredential(credentialId);await loadBiometricCredentials();}catch(err){console.error('Error removing biometric:',err);alert('Failed to remove device. Please try again.');}};const handleBiometricSetupComplete=()=>{setShowBiometricSetup(false);loadBiometricCredentials();};if(showBiometricSetup){return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 pb-20\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"fixed inset-0 -z-10\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-0 left-0 w-96 h-96 bg-purple-500 rounded-full filter blur-3xl opacity-20 animate-pulse\"}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute bottom-0 right-0 w-96 h-96 bg-indigo-500 rounded-full filter blur-3xl opacity-20 animate-pulse delay-1000\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-black/20 backdrop-blur-xl border-b border-white/10 text-white p-6 pb-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowBiometricSetup(false),className:\"mr-4 text-purple-300 hover:text-white transition-colors\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M15 19l-7-7 7-7\"})})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold\",children:\"Add Biometric Device\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-8\",children:/*#__PURE__*/_jsx(BiometricSetup,{onComplete:handleBiometricSetupComplete,onSkip:()=>setShowBiometricSetup(false)})})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 pb-20\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"fixed inset-0 -z-10\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-0 left-0 w-96 h-96 bg-purple-500 rounded-full filter blur-3xl opacity-20 animate-pulse\"}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute bottom-0 right-0 w-96 h-96 bg-indigo-500 rounded-full filter blur-3xl opacity-20 animate-pulse delay-1000\"}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-pink-500 rounded-full filter blur-3xl opacity-10 animate-pulse delay-500\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-black/20 backdrop-blur-xl border-b border-white/10 text-white p-6 pb-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/dashboard'),className:\"mr-4 text-purple-300 hover:text-white transition-colors\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M15 19l-7-7 7-7\"})})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold\",children:\"My Profile\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"px-6 -mt-4 space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/10 backdrop-blur-xl rounded-2xl shadow-xl p-6 border border-white/20\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center mb-6\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-24 h-24 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center text-white text-3xl font-bold shadow-lg\",children:(user===null||user===void 0?void 0:(_user$name=user.name)===null||_user$name===void 0?void 0:(_user$name$charAt=_user$name.charAt(0))===null||_user$name$charAt===void 0?void 0:_user$name$charAt.toUpperCase())||'U'})}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-500/20 border border-red-500/30 text-red-200 px-4 py-3 rounded-lg mb-4\",children:error}),success&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-green-500/20 border border-green-500/30 text-green-200 px-4 py-3 rounded-lg mb-4\",children:success}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-purple-300 mb-2\",children:\"Name\"}),isEditing?/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:name,onChange:e=>setName(e.target.value),className:\"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500\",autoFocus:true}):/*#__PURE__*/_jsx(\"p\",{className:\"text-white text-lg font-semibold\",children:(user===null||user===void 0?void 0:user.name)||'Not set'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-purple-300 mb-2\",children:\"Phone Number\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-white text-lg font-semibold\",children:(user===null||user===void 0?void 0:user.phone)||'Not available'}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-purple-300 bg-purple-500/20 px-2 py-1 rounded\",children:\"Cannot be changed\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-purple-300 mb-2\",children:\"Email\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-white text-lg\",children:(user===null||user===void 0?void 0:user.email)||'Not set'})]}),/*#__PURE__*/_jsx(\"div\",{className:\"pt-4\",children:isEditing?/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleSaveName,disabled:saving,className:\"flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition disabled:opacity-50\",children:saving?'Saving...':'Save Changes'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setIsEditing(false);setName((user===null||user===void 0?void 0:user.name)||'');setError(null);},className:\"flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition\",children:\"Cancel\"})]}):/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setIsEditing(true),className:\"w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-lg font-semibold transition flex items-center justify-center space-x-2\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"})}),/*#__PURE__*/_jsx(\"span\",{children:\"Edit Profile\"})]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/10 backdrop-blur-xl rounded-2xl shadow-xl p-6 border border-white/20\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-xl font-bold text-white mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 mr-2 text-purple-400\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z\"})}),\"My Payment QR Code\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-6 rounded-xl inline-block mb-4\",children:/*#__PURE__*/_jsx(QRCodeSVG,{value:\"upi://pay?pa=\".concat(upiId,\"&pn=\").concat(encodeURIComponent((user===null||user===void 0?void 0:user.name)||'User'),\"&cu=INR\"),size:200,level:\"H\",includeMargin:true})}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-purple-500/20 border border-purple-500/30 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-purple-300 mb-1\",children:\"Your UPI ID\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-white font-mono text-lg font-semibold\",children:upiId}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-purple-300 mt-2\",children:\"Scan this QR code to pay you\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/10 backdrop-blur-xl rounded-2xl shadow-xl p-6 border border-white/20\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-xl font-bold text-white flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 mr-2 text-purple-400\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"})}),\"Biometric Login\"]}),biometricSupported&&biometricCredentials.length>0&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowBiometricSetup(true),className:\"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-semibold transition\",children:\"Add Device\"})]}),!biometricSupported?/*#__PURE__*/_jsx(\"div\",{className:\"bg-yellow-500/20 border border-yellow-500/30 rounded-lg p-4\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-yellow-200 text-sm\",children:\"Biometric authentication is not available on this device.\"})}):loadingBiometric?/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-400\"})}):biometricCredentials.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-6\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-16 h-16 mx-auto text-purple-400 mb-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-purple-200 mb-4\",children:\"No biometric devices registered\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowBiometricSetup(true),className:\"bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-semibold transition\",children:\"Enable Biometric Login\"})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-green-500/20 border border-green-500/30 rounded-lg p-3 mb-4\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-green-200 text-sm flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 mr-2\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"})}),\"Biometric login enabled (\",biometricCredentials.length,\" device\",biometricCredentials.length!==1?'s':'',\")\"]})}),biometricCredentials.map(cred=>/*#__PURE__*/_jsx(\"div\",{className:\"border border-white/20 bg-white/5 rounded-lg p-4 hover:bg-white/10 transition\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-indigo-500/20 rounded-lg p-2\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 text-indigo-300\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z\"})})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-white font-semibold\",children:cred.credential_name||'Unnamed Device'}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-purple-300 mt-1\",children:[\"Added: \",new Date(cred.created_at).toLocaleDateString()]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-purple-300\",children:[\"Last used: \",new Date(cred.last_used).toLocaleDateString()]})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleRemoveBiometric(cred.credential_id,cred.credential_name),className:\"text-red-400 hover:text-red-300 text-sm font-medium px-3 py-1 rounded hover:bg-red-500/20 transition\",children:\"Remove\"})]})},cred.credential_id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/10 backdrop-blur-xl rounded-2xl shadow-xl p-6 border border-white/20\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-white mb-4\",children:\"Quick Actions\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-3\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/send-money'),className:\"bg-indigo-600 hover:bg-indigo-700 text-white py-4 rounded-lg font-semibold transition flex flex-col items-center space-y-2\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\"})}),/*#__PURE__*/_jsx(\"span\",{children:\"Send Money\"})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/transactions'),className:\"bg-purple-600 hover:bg-purple-700 text-white py-4 rounded-lg font-semibold transition flex flex-col items-center space-y-2\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\"})}),/*#__PURE__*/_jsx(\"span\",{children:\"History\"})]})]})]})]})]});};export default ProfileScreen;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}