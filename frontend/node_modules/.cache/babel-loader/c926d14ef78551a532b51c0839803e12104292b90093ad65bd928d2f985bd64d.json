{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{authenticateWithBiometric,isPlatformAuthenticatorAvailable}from'../utils/webauthn';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BiometricPrompt=_ref=>{let{onSuccess,onCancel}=_ref;const navigate=useNavigate();const[isAuthenticating,setIsAuthenticating]=useState(false);const[error,setError]=useState(null);const[isSupported,setIsSupported]=useState(false);const[autoTriggered,setAutoTriggered]=useState(false);// eslint-disable-line no-unused-vars\nuseEffect(()=>{checkSupportAndAutoAuthenticate();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);const checkSupportAndAutoAuthenticate=async()=>{const available=await isPlatformAuthenticatorAvailable();setIsSupported(available);if(available){// Auto-trigger biometric after a short delay\n// No phone number needed anymore - JWT is already validated\nsetAutoTriggered(true);setTimeout(()=>{handleBiometricAuth();},500);}};const handleBiometricAuth=async()=>{setIsAuthenticating(true);setError(null);try{// Call new production endpoint that doesn't require phone\nconst result=await authenticateWithBiometric();if(onSuccess){onSuccess(result);}else{// Fallback navigation\nnavigate('/dashboard');}}catch(err){console.error('Biometric auth error:',err);// Safely extract the message string â€” err may be a plain object or string\nconst errMsg=typeof err==='string'?err:(err===null||err===void 0?void 0:err.message)||'';let errorMessage='Authentication failed';if(errMsg.includes('Failed to fetch')||errMsg.includes('NetworkError')){errorMessage='Cannot connect to server. Please check your connection.';}else if(errMsg.includes('not enabled')){errorMessage='Biometric login not set up for this account. Please use password.';}else if(errMsg.includes('User cancelled')||errMsg.includes('cancelled')){errorMessage='Authentication cancelled';}else{errorMessage=errMsg||errorMessage;}setError(errorMessage);}finally{setIsAuthenticating(false);}};if(!isSupported){return null;}return/*#__PURE__*/_jsxs(\"div\",{className:\"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 rounded-3xl shadow-2xl w-full max-w-md p-8 border border-purple-500/30 animate-fade-in\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-20 h-20 mx-auto bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center mb-4 shadow-lg animate-pulse-slow\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-12 h-12 text-white\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"})})}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-white mb-2\",children:\"Welcome Back!\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-purple-200\",children:\"Use your fingerprint or face to unlock\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-6\",children:isAuthenticating?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-16 h-16 mx-auto mb-4\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-full h-full text-purple-400 animate-pulse\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.132A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.39-2.823 1.07-4\"})})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-white font-semibold\",children:\"Verifying Biometric...\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-purple-300 mt-2\",children:\"Use your fingerprint or face\"})]}):/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleBiometricAuth(),disabled:isAuthenticating,className:\"w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-lg flex items-center justify-center space-x-3 disabled:opacity-50\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"})}),/*#__PURE__*/_jsx(\"span\",{children:\"Verify Biometric\"})]})}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-500/20 border border-red-500/30 text-red-200 px-4 py-3 rounded-lg mb-4\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:error})}),/*#__PURE__*/_jsx(\"div\",{className:\"pt-4 border-t border-white/20\",children:/*#__PURE__*/_jsx(\"button\",{onClick:onCancel,className:\"w-full text-purple-200 hover:text-white py-2 text-sm font-medium transition\",children:\"Use Password Instead\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 text-center\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-purple-300\",children:\"Your biometric data never leaves your device\"})})]}),/*#__PURE__*/_jsx(\"style\",{jsx:true,children:\"\\n        @keyframes fade-in {\\n          from {\\n            opacity: 0;\\n            transform: scale(0.95);\\n          }\\n          to {\\n            opacity: 1;\\n            transform: scale(1);\\n          }\\n        }\\n\\n        .animate-fade-in {\\n          animation: fade-in 0.3s ease-out;\\n        }\\n\\n        @keyframes pulse-slow {\\n          0%, 100% {\\n            transform: scale(1);\\n          }\\n          50% {\\n            transform: scale(1.05);\\n          }\\n        }\\n\\n        .animate-pulse-slow {\\n          animation: pulse-slow 2s ease-in-out infinite;\\n        }\\n      \"})]});};export default BiometricPrompt;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}