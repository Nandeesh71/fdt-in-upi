{"ast":null,"code":"import _objectSpread from\"C:/Users/jerol/OneDrive/Desktop/FDT_HOST/fdt-in-upi/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useRef,useEffect}from'react';import{useNavigate,useLocation}from'react-router-dom';import{createTransaction,searchUsers}from'../api';import{useNotifications}from'./NotificationSystem';import cacheManager from'../utils/cacheManager';// eslint-disable-next-line no-unused-vars\nimport favoritesManager from'../utils/favoritesManager';import errorHandler from'../utils/errorHandler';import RecipientDropdown from'./RecipientDropdown';import TransactionResult from'./TransactionResult';import FavoritesModal from'./FavoritesModal';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const SendMoney=_ref=>{let{user,setUser,onBack,onLogout}=_ref;const navigate=useNavigate();const location=useLocation();const{addNotification}=useNotifications();const[loading,setLoading]=useState(false);const[transactionResult,setTransactionResult]=useState(null);const[searchResults,setSearchResults]=useState([]);const[showDropdown,setShowDropdown]=useState(false);const[showFavoritesModal,setShowFavoritesModal]=useState(false);const[recipientUser,setRecipientUser]=useState(null);const amountRef=useRef(null);const[formData,setFormData]=useState({recipient_vpa:'',amount:'',remarks:''});const[error,setError]=useState('');// Auto-fill from QR scanner\nuseEffect(()=>{if(location.state){const{recipientPhone,scannedUPI,amount}=location.state;// Use the scanned UPI if available, otherwise use phone number\nconst recipientValue=scannedUPI||(recipientPhone?\"\".concat(recipientPhone,\"@upi\"):'');if(recipientValue){setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{recipient_vpa:recipientValue,amount:amount||''}));console.log('✓ Auto-filled from QR scan:',recipientValue);}}// Clear location state after reading it\n// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);const handleChange=e=>{const{name,value}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));setError('');setRecipientUser(null);setShowDropdown(false);};const handleRecipientChange=async value=>{setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{recipient_vpa:value}));setError('');setRecipientUser(null);if(value.length>=3){try{const response=await searchUsers(value);if(response.status==='success'){setSearchResults(response.results);setShowDropdown(true);}else{setSearchResults([]);}}catch(error){// Silent fail for search - don't show error as user is still typing\nerrorHandler.logError(error,'Search Users');setSearchResults([]);}}else{setSearchResults([]);setShowDropdown(false);}};const handleRecipientSelect=user=>{setRecipientUser(user);setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{recipient_vpa:user.upi_id}));setShowDropdown(false);};const formatAmount=value=>{const cleaned=value.replace(/[^\\d.]/g,'');const parts=cleaned.split('.');if(parts.length>2)return value;const integerPart=parts[0]||'';const decimalPart=parts[1]||'';return decimalPart.length>2?integerPart+'.'+decimalPart.slice(0,2):cleaned;};const handleAmountChange=e=>{const formatted=formatAmount(e.target.value);setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{amount:formatted}));setError('');};const validateForm=()=>{// Validate recipient\nif(!formData.recipient_vpa){setError('Please enter a recipient UPI ID or phone number');return false;}// Check if it's a phone number or UPI ID and validate accordingly\nconst isPhoneNumber=/^\\d{10}$/.test(formData.recipient_vpa.replace(/\\D/g,''));const isUPI=formData.recipient_vpa.includes('@');if(!isPhoneNumber&&!isUPI){const{error}=errorHandler.validatePhoneNumber(formData.recipient_vpa);if(!error){const upiValidation=errorHandler.validateUPI(formData.recipient_vpa);if(!upiValidation.isValid){setError(upiValidation.error);return false;}}}// Validate amount\nif(!formData.amount||parseFloat(formData.amount)<=0){setError('Please enter a valid amount greater than ₹0');return false;}// Balance check disabled for fraud detection demo\nreturn true;};const handleSubmit=async e=>{e.preventDefault();if(!validateForm()){return;}setLoading(true);setError('');try{var _response$transaction;const response=await createTransaction({recipient_vpa:formData.recipient_vpa,amount:parseFloat(formData.amount),remarks:formData.remarks||'Payment'});// Update user balance only when the transaction is allowed\nif(response.status==='success'&&((_response$transaction=response.transaction)===null||_response$transaction===void 0?void 0:_response$transaction.action)==='ALLOW'){const newBalance=user.balance-parseFloat(formData.amount);const updatedUser=_objectSpread(_objectSpread({},user),{},{balance:newBalance});setUser(updatedUser);localStorage.setItem('fdt_user',JSON.stringify(updatedUser));}// Set transaction result\nsetTransactionResult({status:response.status,transaction:response.transaction,requiresConfirmation:response.requires_confirmation,riskLevel:response.risk_level,receiverUserId:response.receiver_user_id});// Clear cache\ncacheManager.invalidateCategory('dashboard');cacheManager.invalidateCategory('transactions');}catch(err){// Use error handler for comprehensive error management\nconst errorInfo=errorHandler.handleAPIError(err,'Create Transaction');setError(errorInfo.message);addNotification({type:'error',title:errorInfo.title,message:errorInfo.message,category:'error'});}finally{setLoading(false);}};const handleSelectFavorite=favorite=>{setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{recipient_vpa:favorite.vpa,amount:favorite.amount?favorite.amount.toString():'',remarks:favorite.remarks||''}));setRecipientUser(null);if(amountRef.current&&favorite.amount){amountRef.current.focus();}};// eslint-disable-next-line no-unused-vars\nconst formatCurrency=amount=>{return new Intl.NumberFormat('en-IN',{style:'currency',currency:'INR',maximumFractionDigits:0}).format(amount);};// Show transaction result if available\nif(transactionResult){return/*#__PURE__*/_jsx(TransactionResult,{result:transactionResult,onBack:()=>setTransactionResult(null),senderUser:user});}return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gradient-to-br from-slate-900 via-green-900 to-slate-900\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"fixed inset-0 -z-10\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-0 left-0 w-96 h-96 bg-green-500 rounded-full filter blur-3xl opacity-20 animate-pulse\"}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute bottom-0 right-0 w-96 h-96 bg-teal-500 rounded-full filter blur-3xl opacity-20 animate-pulse delay-1000\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-black/20 backdrop-blur-xl border-b border-white/10 text-white p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(onLogout)onLogout();navigate('/login');},className:\"mr-4 p-2 hover:bg-white/10 rounded-lg transition-colors\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M15 19l-7-7 7-7\"})})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold\",children:\"Send Money\"})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/dashboard'),className:\"flex items-center space-x-2 px-4 py-2 bg-purple-600/80 hover:bg-purple-600 text-white rounded-lg transition-colors\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M9 12l2 2 4-4m7 0a9 9 0 11-18 0 9 9 0 0118 0z\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium\",children:\"Fraud Detection\"})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-md mx-auto\",children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-5\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/10 backdrop-blur-xl rounded-xl p-5 border border-white/20 relative z-10\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-white/80 text-sm mb-2 block\",children:\"Recipient\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"recipient_vpa\",value:formData.recipient_vpa,onChange:e=>handleRecipientChange(e.target.value),placeholder:\"Phone number or UPI ID\",className:\"w-full bg-white/10 text-white placeholder-white/40 rounded-lg px-4 py-3 border border-white/20 focus:border-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-400/50\",disabled:loading,autoComplete:\"off\"}),/*#__PURE__*/_jsx(RecipientDropdown,{show:showDropdown,results:searchResults,onSelect:handleRecipientSelect,onClose:()=>setShowDropdown(false)})]}),recipientUser&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-3 bg-green-500/20 border border-green-500/30 px-3 py-2 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4 text-green-400 mr-2\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-white font-semibold\",children:recipientUser.name}),/*#__PURE__*/_jsx(\"div\",{className:\"text-green-300 text-sm\",children:recipientUser.upi_id})]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/10 backdrop-blur-xl rounded-xl p-5 border border-white/20\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-white/80 text-sm mb-2 block\",children:\"Amount (\\u20B9)\"}),/*#__PURE__*/_jsx(\"input\",{ref:amountRef,type:\"text\",name:\"amount\",value:formData.amount,onChange:handleAmountChange,placeholder:\"0.00\",className:\"w-full bg-white/10 text-white placeholder-white/40 rounded-lg px-4 py-3 border border-white/20 focus:border-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-400/50 text-2xl font-semibold\",disabled:loading}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 flex space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{amount:'500'})),className:\"px-3 py-1 bg-white/20 text-white/80 rounded-lg hover:bg-white/30 text-sm\",disabled:loading,children:\"\\u20B9500\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{amount:'1000'})),className:\"px-3 py-1 bg-white/20 text-white/80 rounded-lg hover:bg-white/30 text-sm\",disabled:loading,children:\"\\u20B91,000\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{amount:'5000'})),className:\"px-3 py-1 bg-white/20 text-white/80 rounded-lg hover:bg-white/30 text-sm\",disabled:loading,children:\"\\u20B95,000\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/10 backdrop-blur-xl rounded-xl p-5 border border-white/20\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-white/80 text-sm mb-2 block\",children:\"Remarks (Optional)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"remarks\",value:formData.remarks,onChange:handleChange,placeholder:\"Add a note...\",className:\"w-full bg-white/10 text-white placeholder-white/40 rounded-lg px-4 py-3 border border-white/20 focus:border-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-400/50\",disabled:loading})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 gap-3\",children:/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>setShowFavoritesModal(true),className:\"flex items-center justify-center space-x-2 px-4 py-3 bg-yellow-600/80 hover:bg-yellow-600 text-white rounded-lg transition-colors text-sm font-medium\",disabled:loading,children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4\",fill:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\"})}),/*#__PURE__*/_jsx(\"span\",{children:\"Saved Recipients\"})]})}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-500/20 backdrop-blur-xl border border-red-500/50 rounded-xl p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 text-red-400 mr-3\",fill:\"currentColor\",viewBox:\"0 0 20 20\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\",clipRule:\"evenodd\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"text-red-100\",children:error})]})}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,className:\"w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-semibold py-4 rounded-xl hover:from-purple-700 hover:to-indigo-700 transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\",children:loading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2\"}),\"Processing...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 mr-2\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M13 7l5 5m0 0l-5 5m5-5H6\"})}),\"Send Money\"]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6 p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 text-purple-400 mr-3 mt-0.5 flex-shrink-0\",fill:\"currentColor\",viewBox:\"0 0 20 20\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\",clipRule:\"evenodd\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-white/60 text-sm\",children:[/*#__PURE__*/_jsx(\"strong\",{className:\"text-white/80\",children:\"Protected by AI:\"}),\" All transactions are analyzed in real-time for fraud detection to keep your money safe.\"]})]})})]})}),/*#__PURE__*/_jsx(FavoritesModal,{isOpen:showFavoritesModal,onClose:()=>setShowFavoritesModal(false),onSelectFavorite:handleSelectFavorite,onAddNew:()=>setShowFavoritesModal(false)})]});};export default SendMoney;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}