{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Link}from'react-router-dom';import{getUserTransactions}from'../api';import{formatAmount,getRiskColor,getRiskLabel}from'../utils/helpers';import{useNotifications}from'./NotificationSystem';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const RiskAnalysis=()=>{const{addNotification}=useNotifications();const[transactions,setTransactions]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[timeRange,setTimeRange]=useState('30d');const[riskFilter,setRiskFilter]=useState('all');const loadRiskData=async()=>{try{setLoading(true);setError(null);const data=await getUserTransactions(100);setTransactions(data.transactions||[]);}catch(error){console.error('RiskAnalysis load error:',error);setError('Unable to load transactions. Please try again.');addNotification({type:'error',title:'Load Failed',message:'Unable to load risk analysis data',category:'error'});}finally{setLoading(false);}};// Load data on component mount\nuseEffect(()=>{loadRiskData();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);// Only run on mount\n// Reload when filters change (but not on initial mount)\nuseEffect(()=>{// Don't trigger on initial render\n// Filters change but data is already loaded, so just re-filter locally\nconsole.log('Filters changed, re-filtering locally');},[timeRange,riskFilter]);const getFilteredTransactions=()=>{let filtered=transactions;if(riskFilter!=='all'){if(riskFilter==='high'){// High risk: BLOCKED (0.70+) or use risk_level field\nfiltered=transactions.filter(tx=>tx.risk_level==='BLOCKED'||tx.risk_score>=0.70);}else if(riskFilter==='medium'){// Medium risk: DELAYED (0.35-0.69)\nfiltered=transactions.filter(tx=>tx.risk_level==='DELAYED'||tx.risk_score>=0.35&&tx.risk_score<0.70);}else{// Low risk: APPROVED (<0.35)\nfiltered=transactions.filter(tx=>tx.risk_level==='APPROVED'||tx.risk_score<0.35);}}return filtered;};const calculateStats=()=>{const filtered=getFilteredTransactions();const totalAmount=filtered.reduce((sum,tx)=>sum+tx.amount,0);const avgRisk=filtered.length>0?filtered.reduce((sum,tx)=>sum+tx.risk_score,0)/filtered.length:0;return{count:filtered.length,totalAmount,avgRisk,blockedCount:filtered.filter(tx=>tx.action==='BLOCK').length,delayedCount:filtered.filter(tx=>tx.action==='DELAY').length,allowedCount:filtered.filter(tx=>tx.action==='ALLOW').length};};const stats=calculateStats();const filteredTransactions=getFilteredTransactions();if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-violet-900 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-white text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-16 h-16 border-4 border-purple-400 border-t-transparent rounded-full animate-spin mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xl\",children:\"Analyzing risk patterns...\"})]})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-violet-900 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-red-900/30 border border-red-500/50 rounded-2xl p-8 max-w-md text-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-16 h-16 text-red-400 mx-auto mb-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 8v4m0 4v.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"})}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-white text-xl font-bold mb-2\",children:\"Load Failed\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-300 mb-6\",children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:loadRiskData,className:\"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors\",children:\"Try Again\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-violet-900\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-black/20 backdrop-blur-sm border-b border-white/10\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-6xl mx-auto px-4 py-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(Link,{to:\"/dashboard\",className:\"text-white/80 hover:text-white flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 mr-2\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M15 19l-7-7 7-7\"})}),\"Back to Dashboard\"]}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-white\",children:\"Risk Analysis\"})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-6xl mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-6 mb-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-white/80 text-sm font-medium mb-2\",children:\"Risk Level\"}),/*#__PURE__*/_jsxs(\"select\",{value:riskFilter,onChange:e=>setRiskFilter(e.target.value),className:\"w-full bg-white/20 border border-white/30 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Transactions\"}),/*#__PURE__*/_jsx(\"option\",{value:\"high\",children:\"High Risk Only\"}),/*#__PURE__*/_jsx(\"option\",{value:\"medium\",children:\"Medium Risk Only\"}),/*#__PURE__*/_jsx(\"option\",{value:\"low\",children:\"Low Risk Only\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-white/80 text-sm font-medium mb-2\",children:\"Time Range\"}),/*#__PURE__*/_jsxs(\"select\",{value:timeRange,onChange:e=>setTimeRange(e.target.value),className:\"w-full bg-white/20 border border-white/30 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"7d\",children:\"Last 7 Days\"}),/*#__PURE__*/_jsx(\"option\",{value:\"30d\",children:\"Last 30 Days\"}),/*#__PURE__*/_jsx(\"option\",{value:\"90d\",children:\"Last 90 Days\"})]})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-2xl border border-blue-400/30\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-blue-100 text-sm font-medium mb-2\",children:\"Total Transactions\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-3xl font-bold text-white\",children:stats.count})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-br from-green-500 to-green-600 p-6 rounded-2xl border border-green-400/30\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-green-100 text-sm font-medium mb-2\",children:\"Total Amount\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-3xl font-bold text-white\",children:formatAmount(stats.totalAmount)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-br from-amber-500 to-orange-600 p-6 rounded-2xl border border-amber-400/30\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-amber-100 text-sm font-medium mb-2\",children:\"Avg Risk Score\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-3xl font-bold text-white\",children:[(stats.avgRisk*100).toFixed(1),\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-br from-red-500 to-pink-600 p-6 rounded-2xl border border-red-400/30\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-red-100 text-sm font-medium mb-2\",children:\"Fraud Attempts\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-3xl font-bold text-white\",children:stats.blockedCount})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-green-500/10 border border-green-500/30 rounded-xl p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-green-500 rounded-full flex items-center justify-center mr-4\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 text-white\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M5 13l4 4L19 7\"})})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-green-400 text-sm\",children:\"Allowed\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-white\",children:stats.allowedCount})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-amber-500/10 border border-amber-500/30 rounded-xl p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-amber-500 rounded-full flex items-center justify-center mr-4\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 text-white\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"})})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-amber-400 text-sm\",children:\"Pending\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-white\",children:stats.delayedCount})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-500/10 border border-red-500/30 rounded-xl p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-red-500 rounded-full flex items-center justify-center mr-4\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 text-white\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M6 18L18 6M6 6l12 12\"})})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-red-400 text-sm\",children:\"Blocked\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-white\",children:stats.blockedCount})]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-white mb-6\",children:\"Detailed Risk Analysis\"}),filteredTransactions.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-20 h-20 mx-auto mb-4 text-gray-400\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 012-2h2a2 2 0 012 2M9 5a2 2 0 012-2h2a2 2 0 012 2\"})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 text-lg font-medium\",children:\"No transactions found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 text-sm mt-2\",children:\"Try adjusting the filters to see more results\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:filteredTransactions.map(tx=>{const riskLevel=getRiskColor(tx.risk_score,tx.risk_level);const riskLabel=getRiskLabel(tx.risk_score,tx.risk_level);return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/5 rounded-xl p-6 border border-white/10 hover:bg-white/10 transition-colors\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 rounded-full mr-3 \".concat(riskLevel==='red'?'bg-red-500':riskLevel==='yellow'?'bg-amber-500':'bg-green-500')}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-white font-semibold\",children:tx.recipient_vpa}),/*#__PURE__*/_jsx(\"p\",{className:\"text-white/60 text-sm\",children:new Date(tx.created_at).toLocaleString()})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-white\",children:formatAmount(tx.amount)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium \".concat(riskLevel==='red'?'text-red-400':riskLevel==='yellow'?'text-amber-400':'text-green-400'),children:riskLabel})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-2\",children:[tx.action==='ALLOW'&&/*#__PURE__*/_jsx(\"span\",{className:\"px-3 py-1 bg-green-500/20 text-green-400 text-xs font-medium rounded-full\",children:\"\\u2705 Approved\"}),tx.action==='DELAY'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"px-3 py-1 bg-amber-500/20 text-amber-400 text-xs font-medium rounded-full\",children:\"\\u23F3 Pending Review\"}),/*#__PURE__*/_jsx(Link,{to:\"/fraud-alert/\".concat(tx.tx_id),className:\"px-3 py-1 bg-purple-500/20 text-purple-400 text-xs font-medium rounded-full hover:bg-purple-500/30\",children:\"Review Transaction\"})]}),tx.action==='BLOCK'&&/*#__PURE__*/_jsx(\"span\",{className:\"px-3 py-1 bg-red-500/20 text-red-400 text-xs font-medium rounded-full\",children:\"\\uD83D\\uDEAB Blocked\"})]}),tx.fraud_reasons&&tx.fraud_reasons.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 pt-4 border-t border-white/10\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-white/60 text-sm mb-2\",children:\"Risk Factors:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-2\",children:tx.fraud_reasons.map((reason,index)=>/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 bg-red-500/10 text-red-300 text-xs rounded\",children:reason},index))})]})]},tx.tx_id);})})]})]})]});};export default RiskAnalysis;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}