{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import{Html5Qrcode}from'html5-qrcode';import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const QRScanner=()=>{const navigate=useNavigate();const[scanning,setScanning]=useState(false);const[error,setError]=useState(null);const[cameras,setCameras]=useState([]);const[selectedCamera,setSelectedCamera]=useState(null);const html5QrCode=useRef(null);const videoElemRef=useRef(null);useEffect(()=>{// Get available cameras\nHtml5Qrcode.getCameras().then(devices=>{if(devices&&devices.length){setCameras(devices);// Try to select back camera for mobile\nconst backCamera=devices.find(device=>device.label.toLowerCase().includes('back')||device.label.toLowerCase().includes('rear'));setSelectedCamera((backCamera===null||backCamera===void 0?void 0:backCamera.id)||devices[0].id);}else{setError('No cameras found on this device.');}}).catch(err=>{console.error('Error getting cameras:',err);setError('Failed to access camera. Please grant camera permissions.');});return()=>{stopScanning();};},[]);const stopScanning=async()=>{if(html5QrCode.current){try{if(html5QrCode.current.isScanning){await html5QrCode.current.stop();}html5QrCode.current.clear();}catch(err){console.error('Error stopping scanner:',err);}}};const startScanning=async()=>{if(!selectedCamera){setError('No camera selected');return;}try{setError(null);setScanning(true);if(!html5QrCode.current){html5QrCode.current=new Html5Qrcode('qr-reader');}await html5QrCode.current.start(selectedCamera,{fps:10,qrbox:{width:250,height:250}},onScanSuccess,onScanFailure);}catch(err){console.error('Error starting scanner:',err);setError('Failed to start scanner. Please try again.');setScanning(false);}};const onScanSuccess=decodedText=>{console.log('QR Code scanned:',decodedText);// Stop scanning\nstopScanning();setScanning(false);// Parse UPI QR code\nif(decodedText.startsWith('upi://')){try{const url=new URL(decodedText);const params=new URLSearchParams(url.search);const payeeAddress=params.get('pa')||'';const payeeName=decodeURIComponent(params.get('pn')||'');const amount=params.get('am')||'';// cu and tn parsed but not yet used\n// const currency = params.get('cu') || 'INR';\n// const transactionNote = decodeURIComponent(params.get('tn') || '');\n// Extract phone number from UPI ID (assuming format: phone@provider)\nconst recipientPhone=payeeAddress.split('@')[0];if(recipientPhone&&/^\\d{10}$/.test(recipientPhone)){// Navigate to SendMoney with pre-filled data\nnavigate('/send-money',{state:{recipientPhone,amount:amount||'',scannedUPI:payeeAddress,payeeName:payeeName}});}else{setError('Invalid UPI ID format. Please try again.');}}catch(err){console.error('Error parsing UPI QR code:',err);setError('Invalid QR code format. Please scan a valid UPI QR code.');}}else{setError('This is not a UPI payment QR code. Please scan a valid UPI QR code.');}};const onScanFailure=error=>{// Ignore scan failures (happens continuously while scanning)\n// console.log('Scan failed:', error);\n};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 pb-20\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"fixed inset-0 -z-10\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-0 left-0 w-96 h-96 bg-purple-500 rounded-full filter blur-3xl opacity-20 animate-pulse\"}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute bottom-0 right-0 w-96 h-96 bg-indigo-500 rounded-full filter blur-3xl opacity-20 animate-pulse delay-1000\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-black/20 backdrop-blur-xl border-b border-white/10 text-white p-6 pb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{stopScanning();navigate('/dashboard');},className:\"mr-4 text-purple-300 hover:text-white transition-colors\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M15 19l-7-7 7-7\"})})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold\",children:\"Scan QR Code\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-purple-300 text-sm ml-10\",children:\"Scan a UPI QR code to make a payment\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"px-6 py-8 space-y-6\",children:[error&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-500/20 border border-red-500/30 text-red-200 px-4 py-3 rounded-lg\",children:error}),cameras.length>1&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/10 backdrop-blur-xl rounded-xl p-4 border border-white/20\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-purple-300 mb-2\",children:\"Select Camera\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedCamera||'',onChange:e=>{setSelectedCamera(e.target.value);if(scanning){stopScanning().then(()=>{setSelectedCamera(e.target.value);});}},disabled:scanning,className:\"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500\",children:cameras.map(camera=>/*#__PURE__*/_jsx(\"option\",{value:camera.id,className:\"bg-slate-800\",children:camera.label},camera.id))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/10 backdrop-blur-xl rounded-2xl shadow-xl p-6 border border-white/20\",children:[/*#__PURE__*/_jsx(\"div\",{id:\"qr-reader\",ref:videoElemRef,className:\"w-full rounded-lg overflow-hidden mb-4\",style:{minHeight:scanning?'300px':'0px'}}),!scanning&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-20 h-20 mx-auto text-purple-400 mb-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z\"})}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-white text-xl font-semibold mb-2\",children:\"Ready to Scan\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-purple-300 text-sm mb-6\",children:\"Position the QR code within the frame to scan\"})]}),!scanning?/*#__PURE__*/_jsxs(\"button\",{onClick:startScanning,disabled:!selectedCamera,className:\"w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white py-4 rounded-lg font-bold text-lg transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-3\",children:[/*#__PURE__*/_jsxs(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"}),/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"})]}),/*#__PURE__*/_jsx(\"span\",{children:\"Start Scanning\"})]}):/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{stopScanning();setScanning(false);},className:\"w-full bg-red-600 hover:bg-red-700 text-white py-4 rounded-lg font-bold text-lg transition flex items-center justify-center space-x-3\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M6 18L18 6M6 6l12 12\"})}),/*#__PURE__*/_jsx(\"span\",{children:\"Stop Scanning\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-indigo-500/20 border border-indigo-500/30 rounded-xl p-4\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-white font-semibold mb-2 flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 mr-2\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"})}),\"How to use\"]}),/*#__PURE__*/_jsxs(\"ul\",{className:\"text-purple-200 text-sm space-y-1 ml-7\",children:[/*#__PURE__*/_jsx(\"li\",{children:\"\\u2022 Tap \\\"Start Scanning\\\" to activate the camera\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u2022 Point your camera at a UPI QR code\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u2022 Hold steady until the code is detected\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u2022 You'll be redirected to payment page automatically\"})]})]})]})]});};export default QRScanner;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}