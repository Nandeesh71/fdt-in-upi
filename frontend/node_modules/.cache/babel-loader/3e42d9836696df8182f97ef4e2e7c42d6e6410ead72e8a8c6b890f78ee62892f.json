{"ast":null,"code":"// API utilities for backend communication\nimport axios from'axios';import cacheManager from'./utils/cacheManager';// â”€â”€â”€ Environment / URL Configuration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nconst USER_BACKEND_URL=process.env.REACT_APP_USER_BACKEND_URL||'http://localhost:8001';const ADMIN_BACKEND_URL=process.env.REACT_APP_ADMIN_BACKEND_URL||'http://localhost:8000';const API_BASE_URL=USER_BACKEND_URL;if(process.env.NODE_ENV==='development'){console.log('ðŸ”§ FDT API Configuration:');console.log('  User Backend URL :',USER_BACKEND_URL);console.log('  Admin Backend URL:',ADMIN_BACKEND_URL);console.log('  Environment      :',process.env.NODE_ENV);console.log('  Current Hostname :',window.location.hostname);}// â”€â”€â”€ Token Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// FIX: Use localStorage for JWT so token persists across app restart.\n//      This allows biometric login to work without re-entering credentials.\n//      Centralize token access so all modules use same storage layer.\nexport const TOKEN_KEY='fdt_token';export const USER_KEY='fdt_user';export const getAuthToken=()=>localStorage.getItem(TOKEN_KEY);export const setAuthToken=token=>localStorage.setItem(TOKEN_KEY,token);export const removeAuthToken=()=>localStorage.removeItem(TOKEN_KEY);export const getStoredUser=()=>{try{return JSON.parse(localStorage.getItem(USER_KEY));}catch(_unused){return null;}};export const setStoredUser=user=>localStorage.setItem(USER_KEY,JSON.stringify(user));export const removeStoredUser=()=>localStorage.removeItem(USER_KEY);// â”€â”€â”€ Axios Instance â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nconst api=axios.create({baseURL:API_BASE_URL,headers:{'Content-Type':'application/json'},timeout:30000});// Attach token to every request\napi.interceptors.request.use(config=>{const token=getAuthToken();if(token){config.headers.Authorization=\"Bearer \".concat(token);}return config;},error=>Promise.reject(error));// Global response handler\napi.interceptors.response.use(response=>{if(process.env.NODE_ENV==='development'){console.log('âœ… API Response:',response.config.url,response.status);}return response;},error=>{var _error$response4;if(process.env.NODE_ENV==='development'){var _error$config,_error$config2,_error$response,_error$response2,_error$response3;console.error('âŒ API Error:',{url:(_error$config=error.config)===null||_error$config===void 0?void 0:_error$config.url,method:(_error$config2=error.config)===null||_error$config2===void 0?void 0:_error$config2.method,status:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status,statusText:(_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.statusText,data:(_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.data,message:error.message});}if(((_error$response4=error.response)===null||_error$response4===void 0?void 0:_error$response4.status)===401){console.warn('âš  Received 401 â€“ token invalid or expired');removeAuthToken();removeStoredUser();cacheManager.clear();window.dispatchEvent(new Event('logout'));if(window.location.pathname!=='/login'){window.location.href='/login';}}return Promise.reject(error);});// â”€â”€â”€ Auth APIs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const registerUser=async userData=>{const response=await api.post('/api/register',userData);return response.data;};export const loginUser=async credentials=>{var _response$data,_response$data2;const response=await api.post('/api/login',credentials);// FIX: persist token + user via the shared helpers so every module agrees\nif((_response$data=response.data)!==null&&_response$data!==void 0&&_response$data.token){setAuthToken(response.data.token);}if((_response$data2=response.data)!==null&&_response$data2!==void 0&&_response$data2.user){setStoredUser(response.data.user);}return response.data;};/**\r\n * Validate JWT token with backend\r\n * \r\n * Called on app load to check if stored JWT is still valid.\r\n * Returns {status: 'valid', user_id: ..., exp: ...} if valid\r\n * Throws 401 if invalid/expired\r\n */export const validateToken=async()=>{try{const response=await api.get('/auth/validate');return response.data;}catch(error){// 401 will be caught by the response interceptor, but we can also throw here\nthrow error;}};/**\r\n * Logout user by clearing tokens and user data\r\n */export const logoutUser=async()=>{removeAuthToken();removeStoredUser();cacheManager.clear();window.dispatchEvent(new Event('logout'));};// â”€â”€â”€ User APIs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const getUserDashboard=async function(){let forceRefresh=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;const cacheKey='user_dashboard';const cachedData=forceRefresh?null:cacheManager.get(cacheKey);if(cachedData)return cachedData;const response=await api.get('/api/user/dashboard');cacheManager.set(cacheKey,response.data,'dashboard');return response.data;};export const getUserTransactions=async function(){let limit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:20;let statusFilter=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let forceRefresh=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;const params={limit};if(statusFilter)params.status_filter=statusFilter;const cacheKey=\"transactions_\".concat(limit,\"_\").concat(statusFilter||'all');const cachedData=forceRefresh?null:cacheManager.get(cacheKey);if(cachedData)return cachedData;const response=await api.get('/api/user/transactions',{params});cacheManager.set(cacheKey,response.data,'transactions');return response.data;};// â”€â”€â”€ Transaction APIs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const createTransaction=async transactionData=>(await api.post('/api/transaction',transactionData)).data;export const submitUserDecision=async decisionData=>(await api.post('/api/user-decision',decisionData)).data;export const confirmTransaction=async txId=>(await api.post('/api/transaction/confirm',{tx_id:txId})).data;export const cancelTransaction=async txId=>(await api.post('/api/transaction/cancel',{tx_id:txId})).data;export const getTransaction=async txId=>(await api.get(\"/api/transaction/\".concat(txId))).data;export const searchUsers=async phone=>(await api.get('/api/users/search',{params:{phone}})).data;export const registerPushToken=async(fcmToken,deviceId)=>(await api.post('/api/push-token',{fcm_token:fcmToken,device_id:deviceId})).data;export const healthCheck=async()=>(await api.get('/api/health')).data;export default api;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}